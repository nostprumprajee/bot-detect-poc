<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bot / Human Behavior + Fingerprinting Demo</title>
<style>
  body { margin:0; font-family:Arial; background:#111; color:#eee; }
  #ui { position:fixed; top:0; left:0; width:320px; height:100%; background:#1b1b1b; padding:15px; overflow-y:auto; border-right:2px solid #333; }
  #canvas { position:absolute; left:320px; top:0; }
  h2 { margin-top:0; }
  .section { margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid #444; }
  label { display:block; margin-top:6px; }
  input[type=range] { width:100%; }
  select, button { width:100%; padding:6px; margin-top:6px; background:#333; color:#fff; border:1px solid #555; }
  #debug { font-size:12px; white-space:pre-wrap; background:#000; padding:10px; margin-top:10px; border:1px solid #444; height:180px; overflow:auto; }
</style>
</head>
<body>
<div id="ui">
  <h2>Bot / Human Simulator</h2>

  <div class="section">
    <h3>Mode</h3>
    <select id="mode">
      <option value="human">Human (Real)</option>
      <option value="straight">Bot: Straight</option>
      <option value="zigzag">Bot: ZigZag</option>
      <option value="circle">Bot: Circle</option>
      <option value="bezier">Bot: BÃ©zier</option>
      <option value="random">Bot: Random Jitter</option>
      <option value="humanlike">Bot: Human-like</option>
    </select>
    <button id="startBot">Start Bot</button>
    <button id="stopBot">Stop Bot</button>
  </div>

  <div class="section">
    <h3>Speed & Behavior</h3>
    <label>Speed <span id="speedVal">2</span></label>
    <input id="speed" type="range" min="1" max="10" value="2" />

    <label>Jitter <span id="jitterVal">1</span></label>
    <input id="jitter" type="range" min="0" max="20" value="1" />

    <label>Smoothing <span id="smoothVal">0.5</span></label>
    <input id="smooth" type="range" min="0" max="1" step="0.1" value="0.5" />
  </div>

  <div class="section">
    <h3>Display</h3>
    <button id="toggleHeat">Toggle Heatmap</button>
    <button id="togglePath">Toggle Path</button>
    <button id="clearCanvas">Clear Screen</button>
  </div>

  <div class="section">
    <h3>Fingerprint Debug</h3>
    <button id="refreshFP">Recalculate Fingerprint</button>
    <div id="debug"></div>
  </div>
  <div class="section">
    <h3>Prediction</h3>
    <button id="runPredict">Run Prediction</button>
    <div id="predictResult" style="margin-top:10px;font-size:14px;background:#000;padding:10px;border:1px solid #444;"></div>
  </div>

</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth - 320;
canvas.height = window.innerHeight;

// STATE
let mouseX = 0, mouseY = 0;
let heatmapEnabled = true;
let pathEnabled = true;
let botRunning = false;
let botAngle = 0;
let botT = 0;
let pathPoints = [];
let bezierP = [{x:100,y:200},{x:300,y:50},{x:600,y:400},{x:900,y:150}];

// Utility random
function rand(n){ return Math.random() * n; }
function jitter(v){ return v + (rand(jitterVal*2) - jitterVal); }

// Controls
let speedVal = 2;
let jitterVal = 1;
let smoothVal = 0.5;

// UI bindings
document.getElementById("speed").oninput = e => {
  speedVal = Number(e.target.value);
  document.getElementById("speedVal").textContent = speedVal;
};

document.getElementById("jitter").oninput = e => {
  jitterVal = Number(e.target.value);
  document.getElementById("jitterVal").textContent = jitterVal;
};

document.getElementById("smooth").oninput = e => {
  smoothVal = Number(e.target.value);
  document.getElementById("smoothVal").textContent = smoothVal;
};

// HEATMAP storage
let heat = Array(canvas.width).fill(0).map(()=>Array(canvas.height).fill(0));

function addHeat(x,y){
  if(!heatmapEnabled) return;
  if(x>=0 && y>=0 && x<canvas.width && y<canvas.height)
    heat[Math.floor(x)][Math.floor(y)]++;
}

// Render heat
function renderHeat(){
  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  const d = img.data;
  for(let x=0; x<canvas.width; x++){
    for(let y=0; y<canvas.height; y++){
      let v = heat[x][y];
      if(v>0){
        const i = (y*canvas.width + x)*4;
        d[i] = 255;
        d[i+1] = 100;
        d[i+2] = 0;
        d[i+3] = Math.min(v*5,150);
      }
    }
  }
  ctx.putImageData(img,0,0);
}

// Human mouse
canvas.addEventListener("mousemove", e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
  addHeat(mouseX,mouseY);
  pathPoints.push({x:mouseX,y:mouseY});
});

// BOT MOVEMENTS
function botStraight(){ mouseX += speedVal; }

function botZigzag(){
  mouseX += speedVal;
  mouseY = canvas.height/2 + Math.sin(mouseX/20)*80;
}

function botCircle(){
  botAngle += 0.02 * speedVal;
  const r = 150;
  mouseX = canvas.width/2 + Math.cos(botAngle)*r;
  mouseY = canvas.height/2 + Math.sin(botAngle)*r;
}

function botBezier(){
  botT += 0.002 * speedVal;
  if(botT>1) botT=0;
  const t=botT, p=bezierP;
  mouseX = (1-t)**3*p[0].x + 3*(1-t)**2*t*p[1].x + 3*(1-t)*t**2*p[2].x + t**3*p[3].x;
  mouseY = (1-t)**3*p[0].y + 3*(1-t)**2*t*p[1].y + 3*(1-t)*t**2*p[2].y + t**3*p[3].y;
}

function botRandom(){
  mouseX += (rand(4)-2)*speedVal;
  mouseY += (rand(4)-2)*speedVal;
}

function botHumanlike(){
  mouseX += speedVal + (rand(3)-1.5);
  mouseY += Math.sin(mouseX/50)*2 + (rand(2)-1);
}

const botMap = {
  straight: botStraight,
  zigzag: botZigzag,
  circle: botCircle,
  bezier: botBezier,
  random: botRandom,
  humanlike: botHumanlike
};

// Main loop
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(botRunning){
    const mode = document.getElementById("mode").value;
    if(mode !== "human") botMap[mode]();
    addHeat(mouseX,mouseY);
    pathPoints.push({x:mouseX,y:mouseY});
  }

  // Draw path
  if(pathEnabled){
    ctx.strokeStyle = "rgba(0,200,255,0.8)";
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    for(let i=0;i<pathPoints.length;i++){
      const p = pathPoints[i];
      if(i===0) ctx.moveTo(p.x,p.y);
      else ctx.lineTo(p.x,p.y);
    }
    ctx.stroke();
  }

  // Draw heat
  if(heatmapEnabled) renderHeat();

  // Cursor
  ctx.beginPath();
  ctx.arc(mouseX,mouseY,5,0,Math.PI*2);
  ctx.fillStyle = "#0f0";
  ctx.fill();

  requestAnimationFrame(loop);
}
loop();

// Buttons

document.getElementById("startBot").onclick = () => botRunning = true;
document.getElementById("stopBot").onclick = () => botRunning = false;

document.getElementById("toggleHeat").onclick = () => heatmapEnabled = !heatmapEnabled;
document.getElementById("togglePath").onclick = () => pathEnabled = !pathEnabled;

// Clear screen
function clearAll(){
  heat = Array(canvas.width).fill(0).map(()=>Array(canvas.height).fill(0));
  pathPoints = [];
}
document.getElementById("clearCanvas").onclick = clearAll;

// Hotkeys
window.addEventListener("keydown", e => {
  if(e.key === "c") clearAll();
  if(e.key === "h") heatmapEnabled = !heatmapEnabled;
  if(e.key === "p") pathEnabled = !pathEnabled;
});

// ðŸ”¥ Prediction Heuristic
function predictBotHuman(){
  // Features
  const total = pathPoints.length;
  if(total < 10) return {score:0.5, label:"Insufficient data"};

  let avgDx=0, avgDy=0, variance=0;
  for(let i=1;i<total;i++){
    const dx = pathPoints[i].x - pathPoints[i-1].x;
    const dy = pathPoints[i].y - pathPoints[i-1].y;
    avgDx += dx; avgDy += dy;
    variance += Math.abs(dx) + Math.abs(dy);
  }
  avgDx/=total; avgDy/=total;
  variance/=total;

  let straightness=0;
  if(total>5){
    const start=pathPoints[0], end=pathPoints[total-1];
    const dist = Math.hypot(end.x-start.x,end.y-start.y);
    const pathLen = pathPoints.reduce((s,p,i)=>i?s+Math.hypot(p.x-pathPoints[i-1].x,p.y-pathPoints[i-1].y):0,0);
    straightness = dist / (pathLen+0.01);
  }

  // heuristics
  let botScore=0;
  if(straightness>0.85) botScore+=0.4;
  if(variance<1.2) botScore+=0.3;
  if(Math.abs(avgDx)>15) botScore+=0.2;

  return {
    score: botScore,
    label: botScore>0.5?"Likely BOT":"Likely Human"
  };
}

// bind
window.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("runPredict").onclick = ()=>{
    const r = predictBotHuman();
    document.getElementById("predictResult").innerText = `Label: ${r.label}\nBot score: ${(r.score*100).toFixed(1)}%`;
  };
});

// ðŸ”¥ Fingerprinting: Canvas + Audio
async function getFingerprint(){
  let fp = {};

  // Canvas
  const c = document.createElement("canvas");
  const cctx = c.getContext("2d");
  c.width = 200; c.height = 50;
  cctx.textBaseline = "top";
  cctx.font = "16px Arial";
  cctx.fillText("FINGERPRINT_TEST",10,10);
  fp.canvasHash = btoa(c.toDataURL());

  // Audio
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = audioCtx.createOscillator();
  const analyser = audioCtx.createAnalyser();
  osc.connect(analyser);
  osc.start();
  const arr = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(arr);
  fp.audioHash = btoa(String.fromCharCode(...arr.slice(0,32)));
  osc.stop();

  return fp;
}

async function refreshFingerprint(){
  const fp = await getFingerprint();
  document.getElementById("debug").textContent = JSON.stringify(fp,null,2);
}
document.getElementById("refreshFP").onclick = refreshFingerprint;
refreshFingerprint();
</script>

</body>
</html>
